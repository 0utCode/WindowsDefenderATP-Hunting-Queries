// Get stats on ExploitGuard events (audit, blocks, or both) - count events and machines per rule

MiscEvents
| where ActionType in ("ExploitGuardHips", "ProcessBlockGeneratingDynamicCode", "ProcessBlockCreatingChildProcess",
"LoadLowILImage", "LoadBinaryFromRemoteShare", "CallWin32k", "LoadNonMicrosoftSignedBinary", "ExportAddressFilter", 
"ImportAddressFilter", "Rop", "ExploitGuardHips", "NetworkFilterLookup")
| extend IsAudit=toboolean(parse_json(AdditionalFields).IsAudit), RuleId=tostring(parse_json(AdditionalFields).RuleId)
| where IsAudit == false
| summarize EventCount=count(), MachinesCount=dcount(ComputerName) by ActionType, RuleId

// TODO arround mid-June 2018 the above query will start returning no results, and should be replaced with this query
MiscEvents
// This query looks for Audit events. To get blocks, query for "Blocked" instead of "Audited".
| where ActionType startswith "ExploitGuard" and ActionType endswith "Audited"
| extend RuleId=tostring(parse_json(AdditionalFields).RuleId)
| summarize EventCount=count(), MachinesCount=dcount(ComputerName) by ActionType, RuleId
